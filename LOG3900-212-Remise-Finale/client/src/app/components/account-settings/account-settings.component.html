<h1>{{ 'Param√®tres de compte' | translate }}</h1>

<!-- ‚úÖ Zone d'affichage des messages -->
@if(successMessage) {
<div class="success-message">{{ successMessage | translate }}</div>
} @if(errorMessage) {
<div class="error-message">{{ errorMessage | translate }}</div>
}

<div class="account-settings">
    <div class="account-row">
        <div class="label">{{ "Nom d'utilisateur :" | translate }}</div>

        <div class="username-container">
            <!-- ‚úÖ Affichage du pseudo en mode lecture seule -->
            @if(!isEditingUsername) {
            <p class="username-text">{{ username }}</p>
            }

            <!-- ‚úÖ Champ d'√©dition du pseudo -->
            <div class="input-error-container">
                <!-- ‚úÖ Champ d'√©dition -->
                @if(isEditingUsername) {
                <input 
                    type="text"
                    [(ngModel)]="username"
                    (input)="onUsernameChange()"
                    placeholder="{{'Nouveau nom d \'utilisateur' | translate }} " 
                    class="username-input"
                    maxlength="15"
                />
                }

                <!-- ‚úÖ Message d'erreur sous l'input -->
                @if(isUsernameAvailable === false) {
                <div class="error-message">{{ "Ce pseudonyme est d√©j√† pris." | translate }}</div>
                }
            </div>
            <!-- ‚úÖ Bouton Modifier -->
            @if(!isEditingUsername) {
            <p class="edit-btn" (click)="enableUsernameEdit()"><i id="fa" class="fa fa-pencil"></i></p> }

            <!-- ‚úÖ Bouton Enregistrer -->
            @if(isEditingUsername) {
            <button class="save-btn" (click)="modifyUsername()">{{ "Enregistrer" | translate }}</button> }
        </div>
    </div>

    <!-- ‚úÖ Avatar align√© -->
    <div class="account-row">
        <div class="label">Avatar :</div>
        <div class="avatars">
            @for(avatarOption of avatars; track avatarOption) {
            <div class="avatar-wrapper" (click)="modifyAvatar(avatarOption.id)">
                <img
                    [src]="avatarOption.preview"
                    [class.selected]="avatar === avatarOption.id"
                    [class.disabled]="!userService.user.avatarsAquired.includes(avatarOption.id)"
                    (click)="modifyAvatar(avatarOption.id)"
                    alt="Avatar"
                    class="avatar-img"
                />
                @if(!userService.user.avatarsAquired.includes(avatarOption.id)){
                <div class="avatar-icons">
                    <div class="lock-icon">üîí</div>
                    @if(userService.user.money > 150) {
                    <div class="shop-icon">üõçÔ∏è</div>
                    }
                </div>
                }
            </div>

            }
        </div>
    </div>

    <!-- ‚úÖ Adresse e-mail align√©e -->
    <div class="account-row">
        <div class="label">{{ "Adresse courriel" | translate}} :</div>
        <p class="user-email">{{ userService.user.email }}</p>
    </div>

    <!-- ‚úÖ Modification du mot de passe align√©e -->
    <div class="account-row">
        <div class="label">{{ "Mot de passe" | translate }} :</div>
        <div class="password-container">
            <!-- ‚úÖ Mot de passe masqu√© par d√©faut -->
            @if(!isEditingPassword) {
            <p class="hidden-password">{{ isPasswordVisible ? userService.user.password : '****************' }}</p>
            <!-- ‚úÖ Bouton pour voir/cacher le mot de passe -->
            <span class="toggle-password" (click)="togglePasswordVisibility()">
                <i class="fa" [ngClass]="isPasswordVisible ? 'fa-eye' : 'fa-eye-slash'"></i>
            </span>
            }

            <!-- ‚úÖ Ic√¥ne crayon pour activer la modification -->
            @if(!isEditingPassword) {
            <p class="edit-btn" (click)="enablePasswordEdit()"><i id="fa" class="fa fa-pencil"></i></p> }

            <!-- ‚úÖ Champ de modification du mot de passe -->
            @if(isEditingPassword) {
            <input [type]="isPasswordVisible ? 'text' : 'password'" [(ngModel)]="newPassword" placeholder="Nouveau mot de passe" />
            <span class="toggle-password" (click)="togglePasswordVisibility()">
                <i class="fa" [ngClass]="isPasswordVisible ? 'fa-eye' : 'fa-eye-slash'"></i>
            </span>
            }

            <!-- ‚úÖ Bouton Enregistrer -->
            @if(isEditingPassword) {
            <button class="save-btn" (click)="saveNewPassword()">{{ "Enregistrer" | translate }}</button> }
        </div>
    </div>

    <!-- ‚úÖ S√©lection de la langue align√©e -->
    <div class="account-row">
        <div class="label">{{ "Langue :" | translate }} </div>
        <select [(ngModel)]="language" (change)="switchLanguage(language)">
            @for(lang of languageOptions; track lang) {
            <option [value]="lang">@if(lang === fr) { Fran√ßais (Par d√©faut) } @else if(lang === en) { English }</option>
            }
        </select>
    </div>

    <!-- ‚úÖ S√©lection du th√®me align√©e -->
    <div class="account-row">
        <div class="label">Th√®me :</div>
        <div class="themes">
            @for(theme of themes; track theme) {
            <div class="theme-wrapper" (click)="modifyTheme(theme.id)">
                <img
                    [src]="theme.preview"
                    [class.selected]="selectedTheme === theme.id"
                    [class.disabled]="!userService.user.themesAquired.includes(theme.id)"
                    (click)="modifyTheme(theme.id)"
                    [alt]="theme.name"
                    class="theme-img"
                />

                @if(!userService.user.themesAquired.includes(theme.id)) {
                <div class="theme-icons">
                    <div class="lock-icon">üîí</div>
                    @if(userService.user.money > 200) {
                    <div class="shop-icon">üõçÔ∏è</div>
                    }
                </div>
                }
            </div>
            }
        </div>
    </div>
</div>

@if(modalOpen) {
    <div class="modal-overlay">
        <div class="modal">
            @if (purchaseAvatarId) {
                <p>{{ "Cet item a un cout de 150$." | translate }}</p>
            }
            @if (purchaseThemeId) {
                <p>{{ "Cet item a un cout de 200$." | translate }}</p>
            }
            <p>{{ "√ätes-vous s√ªr de vouloir l'acheter ?" | translate }}</p>
            <div class="modal-button-container">
                <button class="modal-button" (click)="closeModal()">{{ "Annuler" | translate }}</button>
                <button class="modal-button" (click)="confirmPurchase()">{{ "Confirmer" | translate }}</button>
            </div>
        </div>
    </div>
} 
